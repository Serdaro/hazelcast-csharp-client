<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\HazelcastOptionsBuilder.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using Hazelcast.Configuration;
using Hazelcast.Configuration.Binding;
using Hazelcast.Exceptions;
using Microsoft.Extensions.Configuration;

namespace Hazelcast
{
    /// &lt;summary&gt;
    /// Provides a way to build &lt;see cref=&quot;HazelcastOptions&quot;/&gt; instances in a fluent way.
    /// &lt;/summary&gt;
    public class HazelcastOptionsBuilder
    {
        private string[] _args;
        private Dictionary&lt;string, string&gt; _keyValues;
        private string _optionsFilePath;
        private string _optionsFileName;
        private string _environmentName;
        private string _altKey;
        private List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt; _configureActions;
        private List&lt;Action&lt;IConfigurationBuilder&gt;&gt; _setups;

        /// &lt;summary&gt;
        /// Sets the command-line arguments to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;args&quot;&gt;The command-line arguments.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string[] args)
        {
            _args = args ?? throw new ArgumentNullException(nameof(args));
            return this;
        }

        /// &lt;summary&gt;
        /// Adds a key/value pair to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string key, string value)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));
            // assuming value can be null or empty

            _keyValues ??= new Dictionary&lt;string, string&gt;();
            _keyValues[key] = value;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the path (without filename) to the options files to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;The file path.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the options file is searched in the
        /// default .NET configuration location, which usually is where the application resides.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFilePath(string filePath)
        {
            if (string.IsNullOrWhiteSpace(filePath)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(filePath));

            _optionsFilePath = filePath;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the name (without path, with extension) of the options file to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;fileName&quot;&gt;The name of the file.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is &quot;hazelcast&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFileName(string fileName)
        {
            if (string.IsNullOrWhiteSpace(fileName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(fileName));

            _optionsFileName = fileName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the environment name to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;environmentName&quot;&gt;The environment name.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is determined the standard .NET way,
        /// i.e. from the &lt;c&gt;DOTNET_ENVIRONMENT&lt;/c&gt; and &lt;c&gt;ASPNETCORE_ENVIRONMENT&lt;/c&gt; variables and,
        /// if not specified, defaults to &quot;Production&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithEnvironment(string environmentName)
        {
            if (string.IsNullOrWhiteSpace(environmentName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(environmentName));

            _environmentName = environmentName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the alternate key for options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The alternate key.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithAltKey(string key)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));

            _altKey = key;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;IConfiguration, HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));

            _configureActions ??= new List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt;();
            _configureActions.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IConfigurationBuilder&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;setup&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;IConfigurationBuilder&gt; setup)
        {
            if (setup == null) throw new ArgumentNullException(nameof(setup));

            _setups ??= new List&lt;Action&lt;IConfigurationBuilder&gt;&gt;();
            _setups.Add(setup);
            return this;
        }

        /// &lt;summary&gt;
        /// Binds an additional options instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key for the instance.&lt;/param&gt;
        /// &lt;param name=&quot;instance&quot;&gt;The instance.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder Bind(string key, object instance)
            =&gt; With((configuration, _) =&gt; configuration.HzBind(key, instance));

        private void Configure(IConfiguration configuration, HazelcastOptions options)
        {
            if (_configureActions == null) return;

            foreach (var configure in _configureActions)
                configure(configuration, options);
        }

        private void Setup(IConfigurationBuilder builder)
        {
            builder.AddDefaults(_args, _environmentName);
            builder.AddHazelcast(_args, _keyValues, _optionsFilePath, _optionsFileName, _environmentName);

            if (_setups == null) return;

            foreach (var setup in _setups)
                setup(builder);
        }

        /// &lt;summary&gt;
        /// Builds the options.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The options.&lt;/returns&gt;
        public HazelcastOptions Build()
        {
            return HazelcastOptions.Build(Setup, Configure, _altKey);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[45,13,45,75,0],[46,13,46,25,0],[57,13,57,48,1],[57,49,57,121,0],[60,13,60,61,1],[61,13,61,37,1],[62,13,62,25,1],[76,13,76,53,0],[76,54,76,131,0],[78,13,78,41,0],[79,13,79,25,0],[92,13,92,53,0],[92,54,92,131,0],[94,13,94,41,0],[95,13,95,25,0],[110,13,110,60,0],[110,61,110,145,0],[112,13,112,48,0],[113,13,113,25,0],[123,13,123,48,1],[123,49,123,121,0],[125,13,125,27,1],[126,13,126,25,1],[136,13,136,35,1],[136,36,136,87,0],[138,13,138,88,1],[139,13,139,46,1],[140,13,140,25,1],[150,13,150,31,1],[150,32,150,79,0],[152,13,152,67,1],[153,13,153,32,1],[154,13,154,25,1],[164,16,164,43,0],[164,43,164,78,0],[164,78,164,79,0],[168,13,168,43,1],[168,44,168,51,0],[170,22,170,35,1],[170,36,170,38,1],[170,39,170,56,1],[171,17,171,51,1],[172,9,172,10,1],[176,13,176,58,1],[177,13,177,107,1],[179,13,179,33,1],[179,34,179,41,0],[181,22,181,31,1],[181,32,181,34,1],[181,35,181,42,1],[182,17,182,32,1],[183,9,183,10,1],[191,13,191,70,1]]);
    </script>
  </body>
</html>