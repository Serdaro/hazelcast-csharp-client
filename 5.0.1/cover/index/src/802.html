<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\ExpectedObjects\ExpectedObjects\src\ExpectedObjects\Reporting\ShouldWriter.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ExpectedObjects.Reporting
{
    public class ShouldWriter : IWriter
    {
        const int IndentLength = 2;
        readonly bool _expandObjects = true;
        readonly List&lt;EqualityResult&gt; _results = new List&lt;EqualityResult&gt;();

        public ShouldWriter()
        {
            _expandObjects = Verbosity &gt;= WriterVerbosity.Normal;
        }

        public WriterVerbosity Verbosity { get; set; } = WriterVerbosity.Normal;

        public void Write(EqualityResult content)
        {
            _results.Add(content);
        }

        public string GetFormattedResults()
        {
            var sb = new StringBuilder();

            if (_results.Where(x =&gt; x.Status.Equals(false))
                .Any(x =&gt; IsLeaf(x) || x.ResultType == EqualityResultType.Custom))
            {
                sb.Append($&quot;The expected object did not match the actual object.{Environment.NewLine}&quot;);
                sb.Append(Environment.NewLine);
                sb.Append($&quot;The following issues were found:{Environment.NewLine}&quot;);
                sb.Append(Environment.NewLine);
            }

            var count = 1;

            _results
                .Where(x =&gt; x.Status.Equals(false))
                .Where(x =&gt; IsLeaf(x) || x.ResultType == EqualityResultType.Custom)
                .ToList()
                .ForEach((x, index, collection) =&gt;
                {
                    var isLastMember = index == collection.Count() - 1;
                    var member = !string.IsNullOrEmpty(x.Member) ? x.Member : &quot;Missing instance&quot;;
                    sb.Append($&quot;{count++}) {member}:&quot;);
                    sb.Append(Environment.NewLine);
                    sb.Append(Environment.NewLine);
                    sb.Append(GetFormattedObjects(x, _expandObjects));

                    if (!isLastMember)
                    {
                        sb.Append(Environment.NewLine);
                        sb.Append(Environment.NewLine);
                        sb.Append(Environment.NewLine);
                    }
                });
            return sb.ToString();
        }

        public string GetTrunkFormattedResults()
        {
            var result = _results.SingleOrDefault(IsRoot);
            return GetFormattedObjects(result, _expandObjects);
        }

        string GetFormattedObjects(EqualityResult result, bool expandObjects)
        {
            var sb = new StringBuilder();

            if (result.Actual is IMissingMember)
            {
                sb.Heading($&quot;Expected&quot;);
                sb.Indent($&quot;{result.Expected.ToUsefulString(expandObjects)}&quot;, 2);
                sb.Append(Environment.NewLine);
                sb.Append(Environment.NewLine);
                sb.Heading($&quot;Actual&quot;);
                sb.Indent($&quot;member was missing&quot;, 2);
                sb.Append(Environment.NewLine);
            }
            else if (result.Actual is IUnexpectedElement)
            {
                var actual = result.Actual as IUnexpectedElement;

                sb.Heading($&quot;Expected&quot;);
                sb.Indent($&quot;nothing&quot;, 2);
                sb.Append(Environment.NewLine);
                sb.Append(Environment.NewLine);
                sb.Heading($&quot;Actual&quot;);
                sb.Indent($&quot;{actual.Element.ToUsefulString(expandObjects)}&quot;, 2);
                sb.Append(Environment.NewLine);
            }
            else if (result.Actual is IMissingElement)
            {
                sb.Heading($&quot;Expected&quot;);
                sb.Indent($&quot;{result.Expected.ToUsefulString(expandObjects)}&quot;, 2);
                sb.Append(Environment.NewLine);
                sb.Append(Environment.NewLine);
                sb.Heading($&quot;Actual&quot;);
                sb.Indent($&quot;element was missing&quot;, 2);
                sb.Append(Environment.NewLine);
            }
            else if (result.ResultType == EqualityResultType.Custom)
            {
                sb.Indent($&quot;{result.Message}&quot;);
                sb.Append(Environment.NewLine);
            }
            else
            {
                sb.Heading($&quot;Expected&quot;);
                sb.Indent($&quot;{result.Expected.ToUsefulString(expandObjects)}&quot;, 2);
                sb.Append(Environment.NewLine);
                sb.Append(Environment.NewLine);
                sb.Heading($&quot;Actual&quot;);
                sb.Indent($&quot;{result.Actual.ToUsefulString(expandObjects)}&quot;, 2);
                sb.Append(Environment.NewLine);
            }
            return sb.ToString();
        }

        public bool IsLeaf(EqualityResult result)
        {
            return !_results.Any(x =&gt; x.Member.StartsWith(result.Member + &quot;.&quot;) ||
                                      x.Member.StartsWith(result.Member + &quot;[&quot;) ||
                                      x.Member.Equals(result.Member) &amp;&amp; x.ResultType == EqualityResultType.Custom);
        }

        public bool IsRoot(EqualityResult result)
        {
            return _results.Any(x =&gt; x.Member.Equals(result.Member));
        }
    }

    static class StringBuilderExtensions
    {
        const int IndentLength = 2;

        public static void Indent(this StringBuilder sb, string s, int level = 1)
        {
            var prefix = new string(&#39; &#39;, level * IndentLength);
            sb.Append($&quot;{prefix}{s}&quot;.Replace(Environment.NewLine, $&quot;{Environment.NewLine}{prefix}&quot;));
        }

        public static void Heading(this StringBuilder sb, string s, int level = 1)
        {
            var prefix = new string(&#39; &#39;, level * IndentLength);
            sb.Append($&quot;{prefix}{s}:&quot;.Replace(Environment.NewLine, $&quot;{Environment.NewLine}{prefix}&quot;));
            sb.Append(Environment.NewLine);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,9,11,45,1],[12,9,12,77,1],[14,9,14,30,1],[16,13,16,66,1],[17,9,17,10,1],[19,44,19,48,1],[19,49,19,53,0],[19,58,19,80,1],[23,13,23,35,1],[24,9,24,10,1],[28,13,28,42,0],[30,13,30,37,0],[30,37,30,59,0],[30,59,31,27,0],[31,27,31,81,0],[31,81,31,83,0],[33,17,33,105,0],[34,17,34,48,0],[35,17,35,85,0],[36,17,36,48,0],[39,13,39,27,0],[41,13,42,29,0],[42,29,42,51,0],[42,51,43,29,0],[43,29,43,83,0],[43,83,47,21,0],[47,21,47,72,0],[47,72,48,21,0],[48,21,48,98,0],[48,98,49,21,0],[49,21,49,56,0],[49,56,50,21,0],[50,21,50,52,0],[50,52,51,21,0],[51,21,51,52,0],[51,52,52,21,0],[52,21,52,71,0],[52,71,54,21,0],[54,21,54,39,0],[54,39,56,25,0],[56,25,56,56,0],[56,56,57,25,0],[57,25,57,56,0],[57,56,58,25,0],[58,25,58,56,0],[58,56,60,17,0],[60,17,60,18,0],[60,18,60,20,0],[61,13,61,34,0],[66,13,66,59,0],[67,13,67,64,0],[72,13,72,42,0],[74,13,74,49,0],[76,17,76,41,0],[77,17,77,82,0],[78,17,78,48,0],[79,17,79,48,0],[80,17,80,39,0],[81,17,81,53,0],[82,17,82,48,0],[84,18,84,58,0],[86,17,86,66,0],[88,17,88,41,0],[89,17,89,42,0],[90,17,90,48,0],[91,17,91,48,0],[92,17,92,39,0],[93,17,93,81,0],[94,17,94,48,0],[96,18,96,55,0],[98,17,98,41,0],[99,17,99,82,0],[100,17,100,48,0],[101,17,101,48,0],[102,17,102,39,0],[103,17,103,54,0],[104,17,104,48,0],[106,18,106,69,0],[108,17,108,48,0],[109,17,109,48,0],[113,17,113,41,0],[114,17,114,82,0],[115,17,115,48,0],[116,17,116,48,0],[117,17,117,39,0],[118,17,118,80,0],[119,17,119,48,0],[121,13,121,34,0],[126,13,126,39,0],[126,39,128,114,0],[128,114,128,116,0],[133,13,133,38,0],[133,38,133,68,0],[133,68,133,70,0],[143,13,143,64,0],[144,13,144,102,0],[145,9,145,10,0],[149,13,149,64,0],[150,13,150,103,0],[151,13,151,44,0],[152,9,152,10,0]]);
    </script>
  </body>
</html>