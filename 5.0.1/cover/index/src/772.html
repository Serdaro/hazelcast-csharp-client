<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\ExpectedObjects\ExpectedObjects\src\ExpectedObjects\ConfigurationContext.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;
using ExpectedObjects.Strategies;

namespace ExpectedObjects
{
    public class ConfigurationContext&lt;TExpected&gt; : IConfigurationContext&lt;TExpected&gt;, IConfiguration, IMemberConfigurationContext
    {
        MemberType _memberType = MemberType.PublicFields;
        Stack&lt;IComparisonStrategy&gt; _strategies = new Stack&lt;IComparisonStrategy&gt;();
        readonly IList&lt;IMemberComparison&gt; _memberComparisons = new List&lt;IMemberComparison&gt;();
        IDictionary&lt;Type, IComparisonStrategy&gt; _typeStrategies = new Dictionary&lt;Type, IComparisonStrategy&gt;();

        public ConfigurationContext(TExpected @object)
        {
            Object = @object;
        }

        public IEnumerable&lt;IComparisonStrategy&gt; ComparisonStrategies =&gt; _strategies;

        public IEnumerable&lt;IMemberComparison&gt; MemberComparisons =&gt; _memberComparisons;

        public IComparisonStrategy GetTypeStrategy(Type type)
        {
            _typeStrategies.TryGetValue(type, out var strategy);
            return strategy;
        }

        public BindingFlags GetFieldBindingFlags()
        {
            BindingFlags flags = 0;

            if (_memberType.HasFlag(MemberType.PublicFields))
                flags |= BindingFlags.Public | BindingFlags.Instance;

            return flags;
        }

        public object Object { get; }

        public void PushStrategy&lt;T&gt;() where T : IComparisonStrategy, new()
        {
            _strategies.Push(new T());
        }

        public void PushStrategy(IComparisonStrategy comparisonStrategy)
        {
            _strategies.Push(comparisonStrategy);
        }

        public void RemoveStrategy&lt;T&gt;() where T: IComparisonStrategy
        {
            var list = _strategies.ToList();
            var existingIndex = list.FindIndex(s =&gt; typeof(T) == s.GetType());

            if (existingIndex &gt;= 0)
            {
                list.RemoveAt(existingIndex);
                list.Reverse();
                _strategies = new Stack&lt;IComparisonStrategy&gt;(list);
            }
        }

        public void IncludeMemberTypes(MemberType memberType)
        {
            _memberType |= memberType;
        }

        public void ReplaceStrategy&lt;TExistingStrategy, TNewStrategy&gt;() where TExistingStrategy : IComparisonStrategy
            where TNewStrategy : IComparisonStrategy, new()
        {
            var list = _strategies.ToList();
            var existingIndex = list.FindIndex(s =&gt; typeof(TExistingStrategy) == s.GetType());

            if (existingIndex == -1)
                throw new Exception($&quot;The strategy {typeof(TExistingStrategy)} was not registered.&quot;);

            if (existingIndex &gt;= 0)
            {
                list.RemoveAt(existingIndex);
                list.Insert(existingIndex, new TNewStrategy());
                list.Reverse();
                _strategies = new Stack&lt;IComparisonStrategy&gt;(list);
            }
        }

        public void ClearStrategies()
        {
            _strategies.Clear();
        }

        public void MapStrategy&lt;T&gt;(IComparisonStrategy comparisonStrategy)
        {
            _typeStrategies.Add(typeof(T), comparisonStrategy);
        }

        public IMemberContext Member&lt;TMember&gt;(Expression&lt;Func&lt;TExpected, TMember&gt;&gt; memberExpression)
        {
            return new ExpressionMemberContext&lt;TExpected, TMember&gt;(this, Object.GetType(), memberExpression);
        }

        public IMemberContext Member(string memberPath)
        {
            return new AbsolutePathMemberContext(this, Object.GetType(), memberPath);
        }

        public IMemberContext RelativeMember(string memberPath)
        {
            return new RelativePathMemberContext(this, memberPath);
        }

        void IMemberConfigurationContext.ConfigureMember(IMemberComparison memberComparison)
        {
            _memberComparisons.Add(memberComparison);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,9,12,58,1],[13,9,13,83,1],[14,9,14,94,1],[15,9,15,110,1],[17,9,17,55,1],[19,13,19,30,1],[20,9,20,10,1],[22,73,22,84,1],[24,68,24,86,1],[28,13,28,65,1],[29,13,29,29,1],[34,13,34,36,1],[36,13,36,62,1],[37,17,37,70,1],[39,13,39,26,1],[42,32,42,36,0],[46,13,46,39,1],[47,9,47,10,1],[51,13,51,50,0],[52,9,52,10,0],[56,13,56,45,0],[57,13,57,53,0],[57,53,57,77,0],[57,77,57,79,0],[59,13,59,36,0],[61,17,61,46,0],[62,17,62,32,0],[63,17,63,68,0],[65,9,65,10,0],[69,13,69,39,0],[70,9,70,10,0],[75,13,75,45,0],[76,13,76,53,0],[76,53,76,93,0],[76,93,76,95,0],[78,13,78,37,0],[79,17,79,102,0],[81,13,81,36,0],[83,17,83,46,0],[84,17,84,64,0],[85,17,85,32,0],[86,17,86,68,0],[88,9,88,10,0],[92,13,92,33,0],[93,9,93,10,0],[97,13,97,64,0],[98,9,98,10,0],[102,13,102,110,0],[107,13,107,86,0],[112,13,112,68,1],[117,13,117,54,1],[118,9,118,10,1]]);
    </script>
  </body>
</html>