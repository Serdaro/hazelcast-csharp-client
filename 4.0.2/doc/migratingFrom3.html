<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Migrating from v3 | Hazelcast .NET Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Migrating from v3 | Hazelcast .NET Documentation ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper" class="">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" src="../../images/hazelcast-logo.png" alt="">
                <span>Hazelcast .NET</span>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
                
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="migrating-from-v3">Migrating from v3</h1>

<p>Version 4 of the Hazelcast .NET client has been massively refactored in order to benefit from the asynchronous features of the C# language. For instance, its low-level networking stack relies on Microsoft&#39;s <a href="https://docs.microsoft.com/en-us/dotnet/standard/io/pipelines">System.IO.Pipelines</a> library. This is the high-performance library that is used, for instance, to power the Kestrel web server. It is constantly improved, as it is the foundation of all high-performance networking in .NET Core 3.x (and the upcoming .NET Core 5.x).</p>
<p>The <em>concepts</em> however have not changed much.</p>
<h2 id="threading-async-and-tasks">Threading, Async and Tasks</h2>
<p>Threading has been greatly simplified and now entirely relies on the async/await pattern. In the current version of the code, all tasks run on the default task scheduler, and there is no limit on, for instance, the amount of concurrent tasks. All tasks run on the default .NET ThreadPool and the default Task scheduler. Depending on feedback, we could consider using custom Task schedulers and/or thread pools.</p>
<h2 id="configuration">Configuration</h2>
<p>In previous versions, the Hazelcast .NET client used to rely on a custom configuration solution based upon an XML file.</p>
<p>The Hazelcast .NET client now uses the configuration abstractions proposed by the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration">Microsoft.Extensions.Configuration</a> namespace. These abstractions provide built-in support for command-line arguments, environment variables, configuration files or in-memory configuration. For instance, they automatically support one configuration value being supplied via the configuration file, and/or a command-line argument, and/or an environment variable. They automatically parse configuration files into their strongly-typed (classes) counterpart.</p>
<p>This also means that the same configuration mechanism can be used by the various libraries used in users&#39; applications.</p>
<p>The most important consequence for users is that the current XML configuration file is replaced with a very similar JSON file.</p>
<p>Refer to the <a href="configuration.html">Configuration</a> page for details on configuration.</p>
<h2 id="logging">Logging</h2>
<p>In previous versions, the Hazelcast .NET client used to rely on a custom logging solution.</p>
<p>The Hazelcast .NET client now uses the logging abstractions proposed by the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging">Microsoft.Extensions.Logging</a> namespace. These abstractions come with a range of providers to log to the console, and other various destinations. In addition, a variety of third-party products (such as <a href="https://serilog.net/">Serilog</a>) support complex logging patterns and more destinations (to the filesystem, the Cloud, etc).</p>
<p>This also means that the same logging mechanism can be used by the various libraries used in users&#39; applications.</p>
<h2 id="locking">Locking</h2>
<p>Previous versions of the Hazelcast .NET Client attached locks to threads, in a way similar to the thread-based model that .NET provides with, for instance, the <code>lock</code> statement. Due to the systematic usage of <code>async</code>/<code>await</code> asynchronous patterns, this is not applicable anymore, and is replaced with a new model based upon an <code>AsyncContext</code> class. In order to execute work in a new context (which would correspond to executing work on a different thread for previous versions), one has to use a new context:</p>
<pre><code class="lang-csharp">// executes in the same, current context
await DoSomethingAsync(...);

using (AsyncContext.New())
{
    // executes in a new context
    await DoSomethingAsync(...);
}
</code></pre><p>Refer to the <a href="locking.html">Locking</a> page for details.</p>
<h2 id="events">Events</h2>
<p>In previous versions, the Hazelcast .NET Client use <em>listeners</em> to handle events. Current versions move to a handler-based model closer to the C# <code>event</code> model, though with a different syntax for adding and removing handlers, due to the asynchronous nature of these operations. For instance:</p>
<pre><code class="lang-csharp">// subscribe
var id = await client.SubscribeAsync(events =&gt; events
    .MembersUpdated((sender, args) =&gt; HandleMembersUpdated(sender, args)));

// handle
private void HandleMembersUpdated(IHazelcastClient client, MembersUpdatedEventArgs args)
{
    ...
}

// unsubscribe
await client.UnsubscribeAsync(id);
</code></pre><p>Refer to the <a href="events.html">Events</a> page for details.</p>
<h2 id="dependency-injection">Dependency Injection</h2>
<p>Dependency injection is becoming more and more common in large .NET applications. The Hazelcast .NET client includes support (via a separate assembly and NuGet package) for the dependency injection abstractions proposed by the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Microsoft.Extensions.DependencyInjection</a> namespace. This allows users to register Hazelcast objects in a dependency injection container.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright &copy; 2010-2021 Hazelcast, Inc. All rights reserved.<br>Generated by DocFX.
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
