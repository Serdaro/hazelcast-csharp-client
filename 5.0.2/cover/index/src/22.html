<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\HazelcastOptionsBuilder.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using Hazelcast.Configuration;
using Hazelcast.Configuration.Binding;
using Hazelcast.Exceptions;
using Microsoft.Extensions.Configuration;

namespace Hazelcast
{
    /// &lt;summary&gt;
    /// Provides a way to build &lt;see cref=&quot;HazelcastOptions&quot;/&gt; instances in a fluent way.
    /// &lt;/summary&gt;
    public class HazelcastOptionsBuilder
    {
        private string[] _args;
        private IDictionary&lt;string, string&gt; _switchMappings;
        private Dictionary&lt;string, string&gt; _defaults;
        private Dictionary&lt;string, string&gt; _keyValues;
        private string _optionsFilePath;
        private string _optionsFileName;
        private string _environmentName;
        private string _altKey;
        private List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt; _configureActions;
        private List&lt;Action&lt;HazelcastOptions&gt;&gt; _preConfigureActions;
        private List&lt;Action&lt;IConfigurationBuilder&gt;&gt; _setups;

        /// &lt;summary&gt;
        /// Sets the command-line arguments to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;args&quot;&gt;The command-line arguments.&lt;/param&gt;
        /// &lt;param name=&quot;switchMappings&quot;&gt;Optional command-line switch mappings.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string[] args, IDictionary&lt;string, string&gt; switchMappings = null)
        {
            _args = args ?? throw new ArgumentNullException(nameof(args));
            _switchMappings = switchMappings;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds a default key/value pair to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithDefault(string key, string value)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));
            // assuming value can be null or empty

            _defaults ??= new Dictionary&lt;string, string&gt;();
            _defaults[key] = value;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds a key/value pair to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string key, string value)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));
            // assuming value can be null or empty

            _keyValues ??= new Dictionary&lt;string, string&gt;();
            _keyValues[key] = value;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the path (without filename) to the options files to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;The file path.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the options file is searched in the
        /// default .NET configuration location, which usually is where the application resides.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFilePath(string filePath)
        {
            if (string.IsNullOrWhiteSpace(filePath)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(filePath));

            _optionsFilePath = filePath;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the name (without path, with extension) of the options file to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;fileName&quot;&gt;The name of the file.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is &quot;hazelcast&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFileName(string fileName)
        {
            if (string.IsNullOrWhiteSpace(fileName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(fileName));

            _optionsFileName = fileName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the environment name to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;environmentName&quot;&gt;The environment name.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is determined the standard .NET way,
        /// i.e. from the &lt;c&gt;DOTNET_ENVIRONMENT&lt;/c&gt; and &lt;c&gt;ASPNETCORE_ENVIRONMENT&lt;/c&gt; variables and,
        /// if not specified, defaults to &quot;Production&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithEnvironment(string environmentName)
        {
            if (string.IsNullOrWhiteSpace(environmentName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(environmentName));

            _environmentName = environmentName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the alternate key for options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The alternate key.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithAltKey(string key)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));

            _altKey = key;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;IConfiguration, HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));

            _configureActions ??= new List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt;();
            _configureActions.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; default configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithDefault(Action&lt;HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));
            _preConfigureActions ??= new List&lt;Action&lt;HazelcastOptions&gt;&gt;();
            _preConfigureActions.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));
            return With((_, o) =&gt; configure(o));
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IConfigurationBuilder&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder ConfigureBuilder(Action&lt;IConfigurationBuilder&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));

            _setups ??= new List&lt;Action&lt;IConfigurationBuilder&gt;&gt;();
            _setups.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Binds an additional options instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key for the instance.&lt;/param&gt;
        /// &lt;param name=&quot;instance&quot;&gt;The instance.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder Bind(string key, object instance)
            =&gt; With((configuration, _) =&gt; configuration.HzBind(key, instance));

        private void PreConfigure(HazelcastOptions options)
        {
            if (_preConfigureActions == null) return;

            foreach (var preConfigure in _preConfigureActions)
                preConfigure(options);
        }

        private void Configure(IConfiguration configuration, HazelcastOptions options)
        {
            if (_configureActions == null) return;

            foreach (var configure in _configureActions)
                configure(configuration, options);
        }

        private void Setup(IConfigurationBuilder builder)
        {
            builder.AddHazelcastAndDefaults(_args, _switchMappings, _defaults, _keyValues, _optionsFilePath, _optionsFileName, _environmentName);

            if (_setups == null) return;

            foreach (var setup in _setups)
                setup(builder);
        }

        /// &lt;summary&gt;
        /// Builds the options.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The options.&lt;/returns&gt;
        public HazelcastOptions Build()
        {
            return HazelcastOptions.Build(Setup, PreConfigure, Configure, _altKey);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[49,13,49,75,0],[50,13,50,46,0],[51,13,51,25,0],[62,13,62,48,0],[62,49,62,121,0],[65,13,65,60,0],[66,13,66,36,0],[67,13,67,25,0],[78,13,78,48,1],[78,49,78,121,0],[81,13,81,61,1],[82,13,82,37,1],[83,13,83,25,1],[97,13,97,53,0],[97,54,97,131,0],[99,13,99,41,0],[100,13,100,25,0],[113,13,113,53,0],[113,54,113,131,0],[115,13,115,41,0],[116,13,116,25,0],[131,13,131,60,0],[131,61,131,145,0],[133,13,133,48,0],[134,13,134,25,0],[144,13,144,48,1],[144,49,144,121,0],[146,13,146,27,1],[147,13,147,25,1],[157,13,157,35,1],[157,36,157,87,0],[159,13,159,88,1],[160,13,160,46,1],[161,13,161,25,1],[171,13,171,35,0],[171,36,171,87,0],[172,13,172,75,0],[173,13,173,49,0],[174,13,174,25,0],[184,13,184,35,1],[184,36,184,87,0],[185,13,185,35,1],[185,35,185,47,1],[185,47,185,49,1],[195,13,195,35,1],[195,36,195,87,0],[197,13,197,67,1],[198,13,198,36,1],[199,13,199,25,1],[209,16,209,43,0],[209,43,209,78,0],[209,78,209,79,0],[213,13,213,46,1],[213,47,213,54,1],[215,22,215,38,0],[215,39,215,41,0],[215,42,215,62,0],[216,17,216,39,0],[217,9,217,10,0],[221,13,221,43,1],[221,44,221,51,1],[223,22,223,35,1],[223,36,223,38,1],[223,39,223,56,1],[224,17,224,51,1],[225,9,225,10,1],[229,13,229,146,1],[231,13,231,33,1],[231,34,231,41,1],[233,22,233,31,1],[233,32,233,34,1],[233,35,233,42,1],[234,17,234,32,1],[235,9,235,10,1],[243,13,243,84,1]]);
    </script>
  </body>
</html>