<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\Clustering\ObjectLifecycleEventSubscription.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2021, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Threading.Tasks;
using Hazelcast.Core;
using Hazelcast.Events;
using Hazelcast.Protocol.Codecs;

namespace Hazelcast.Clustering
{
    internal class ObjectLifecycleEventSubscription : EventSubscriptionBase
    {
        private readonly bool _isSmart;

        public ObjectLifecycleEventSubscription(ClusterState clusterState, ClusterEvents clusterEvents)
            : base(clusterState, clusterEvents)
        {
            _isSmart = clusterState.Options.Networking.SmartRouting;
        }

        protected override ClusterSubscription CreateSubscription()
        {
            return new ClusterSubscription(
                ClientAddDistributedObjectListenerCodec.EncodeRequest(_isSmart),
                (message, state) =&gt; ClientAddDistributedObjectListenerCodec.DecodeResponse(message).Response,
                (id, state) =&gt; ClientRemoveDistributedObjectListenerCodec.EncodeRequest(id),
                (message, state) =&gt; ClientRemoveDistributedObjectListenerCodec.DecodeResponse(message).Response,
                (message, state) =&gt; ClientAddDistributedObjectListenerCodec.HandleEventAsync(message, HandleCodecEvent, null, LoggerFactory));
        }

        internal Func&lt;DistributedObjectCreatedEventArgs, ValueTask&gt; ObjectCreated { get; set; }

        internal Func&lt;DistributedObjectDestroyedEventArgs, ValueTask&gt; ObjectDestroyed { get; set; }

        private ValueTask HandleCodecEvent(string name, string serviceName, string eventTypeName, Guid memberId, object state)
        {
            return eventTypeName switch
            {
                &quot;CREATED&quot; =&gt; ObjectCreated == null
                    ? default
                    : ObjectCreated.AwaitEach(new DistributedObjectCreatedEventArgs(serviceName, name, memberId)),

                &quot;DESTROYED&quot; =&gt; ObjectDestroyed == null
                    ? default
                    : ObjectDestroyed.AwaitEach(new DistributedObjectDestroyedEventArgs(serviceName, name, memberId)),

                _ =&gt; throw new NotSupportedException($&quot;Event type \&quot;{eventTypeName}\&quot; is not supported.&quot;)
            };
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[28,15,28,48,1],[30,13,30,69,1],[31,9,31,10,1],[35,13,37,37,1],[37,37,37,109,1],[37,109,38,32,1],[38,32,38,92,1],[38,92,39,37,1],[39,37,39,112,0],[39,112,40,37,1],[40,37,40,141,1],[40,141,40,143,1],[43,85,43,89,1],[43,90,43,94,1],[45,89,45,93,1],[45,94,45,98,1],[49,13,51,30,1],[51,30,53,114,1],[53,114,55,32,1],[55,32,57,118,1],[57,118,59,22,1],[59,22,59,106,0],[59,106,60,15,1]]);
    </script>
  </body>
</html>