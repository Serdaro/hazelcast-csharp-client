<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\Serialization\SerializationOptions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2021, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using System.Text;
using Hazelcast.Configuration;
using Hazelcast.Configuration.Binding;
using Hazelcast.Core;

// suppress warning about IPortableFactory not being disposed
// TODO: should HazelcastOptions be IDisposable so in the end we dispose these factories?
#pragma warning disable CA2000 // Dispose objects before losing scope

namespace Hazelcast.Serialization
{
    /// &lt;summary&gt;
    /// Contains the serialization options
    /// &lt;/summary&gt;
    /// &lt;remarks&gt;
    /// &lt;see cref=&quot;IIdentifiedDataSerializable&quot;/&gt;, &lt;see cref=&quot;IPortable&quot;/&gt;, custom serializers, and global serializer can be configured using this config.
    /// &lt;/remarks&gt;
    public sealed class SerializationOptions
    {
        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;SerializationOptions&quot;/&gt; class.
        /// &lt;/summary&gt;
        public SerializationOptions()
        {
            PortableFactories = new List&lt;FactoryOptions&lt;IPortableFactory&gt;&gt;();
            PortableFactoriesBinder = new CollectionBinder&lt;IdentifiedInjectionOptions&gt;(item =&gt;
            {
                PortableFactories.Add(new FactoryOptions&lt;IPortableFactory&gt;
                {
                    Id = item.Id,
                    Creator = () =&gt; ServiceFactory.CreateInstance&lt;IPortableFactory&gt;(item.TypeName, item.Args)
                });
            });

            DataSerializableFactories = new List&lt;FactoryOptions&lt;IDataSerializableFactory&gt;&gt;();
            DataSerializableFactoriesBinder = new CollectionBinder&lt;IdentifiedInjectionOptions&gt;(item =&gt;
            {
                DataSerializableFactories.Add(new FactoryOptions&lt;IDataSerializableFactory&gt;
                {
                    Id = item.Id,
                    Creator = () =&gt; ServiceFactory.CreateInstance&lt;IDataSerializableFactory&gt;(item.TypeName, item.Args)
                });
            });

            Serializers = new List&lt;SerializerOptions&gt;();
            SerializersBinder = new CollectionBinder&lt;SerializerInjectionOptions&gt;(item =&gt;
            {
                Serializers.Add(new SerializerOptions
                {
                    SerializedType = Type.GetType(item.SerializedTypeName) ?? throw new ConfigurationException($&quot;Unknown serialized type \&quot;{item.SerializedTypeName}\&quot;.&quot;),
                    Creator = () =&gt; ServiceFactory.CreateInstance&lt;ISerializer&gt;(item.TypeName, item.Args)
                });
            });
        }

        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;SerializationOptions&quot;/&gt; class.
        /// &lt;/summary&gt;
        private SerializationOptions(SerializationOptions other)
        {
            Endianness = other.Endianness;
            ValidateClassDefinitions = other.ValidateClassDefinitions;
            PortableVersion = other.PortableVersion;

            ClassDefinitions = new HashSet&lt;IClassDefinition&gt;(other.ClassDefinitions);
            PortableFactories = new List&lt;FactoryOptions&lt;IPortableFactory&gt;&gt;(other.PortableFactories);
            DataSerializableFactories = new List&lt;FactoryOptions&lt;IDataSerializableFactory&gt;&gt;(other.DataSerializableFactories);

            GlobalSerializer = other.GlobalSerializer?.Clone();
            Serializers = new List&lt;SerializerOptions&gt;(other.Serializers);
        }


        /// &lt;summary&gt;
        /// Gets or sets the &lt;see cref=&quot;Endianness&quot;/&gt;. This value should match the server configuration.
        /// &lt;/summary&gt;
        public Endianness Endianness { get; set; } = Endianness.BigEndian;

        /// &lt;summary&gt;
        /// Whether to check for class definition errors at start,
        /// and throw an Serialization Exception with error definition.
        /// &lt;/summary&gt;
        public bool ValidateClassDefinitions { get; set; } = true;

        /// &lt;summary&gt;
        /// Gets or sets the portable version.
        /// &lt;/summary&gt;
        public int PortableVersion { get; set; }

        #region Class Definitions

        /// &lt;summary&gt;
        /// Gets the collection of &lt;see cref=&quot;IClassDefinition&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;This can only be done programmatically.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public ICollection&lt;IClassDefinition&gt; ClassDefinitions { get; } = new HashSet&lt;IClassDefinition&gt;();

        #endregion

        #region Portable Factories

        /// &lt;summary&gt;
        /// Gets the collection of &lt;see cref=&quot;FactoryOptions{T}&quot;/&gt; of &lt;see cref=&quot;IPortableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        [BinderIgnore]
        public ICollection&lt;FactoryOptions&lt;IPortableFactory&gt;&gt; PortableFactories { get; }

#pragma warning disable IDE0052 // Remove unread private members - used by binding
        [BinderIgnore(false)]
        [BinderName(&quot;portableFactories&quot;)]
        private CollectionBinder&lt;IdentifiedInjectionOptions&gt; PortableFactoriesBinder { get; }
#pragma warning restore IDE0052 // Remove unread private members

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IPortableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factory&quot;&gt;The factory.&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddPortableFactory(int factoryId, IPortableFactory factory)
        {
            PortableFactories.Add(new FactoryOptions&lt;IPortableFactory&gt; { Id = factoryId, Creator = () =&gt; factory });
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IPortableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factoryType&quot;&gt;The type of the factory&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddPortableFactory(int factoryId, Type factoryType)
        {
            PortableFactories.Add(new FactoryOptions&lt;IPortableFactory&gt; { Id = factoryId, Creator = () =&gt; ServiceFactory.CreateInstance&lt;IPortableFactory&gt;(factoryType, null) });
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IPortableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factoryTypeName&quot;&gt;The type name of the factory&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddPortableFactory(int factoryId, string factoryTypeName)
        {
            PortableFactories.Add(new FactoryOptions&lt;IPortableFactory&gt; { Id = factoryId, Creator = () =&gt; ServiceFactory.CreateInstance&lt;IPortableFactory&gt;(factoryTypeName, null) });
            return this;
        }

        #endregion

        #region Data Serializable Factories

        /// &lt;summary&gt;
        /// Gets the collection of &lt;see cref=&quot;FactoryOptions{T}&quot;/&gt; of &lt;see cref=&quot;IDataSerializableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        [BinderIgnore]
        public ICollection&lt;FactoryOptions&lt;IDataSerializableFactory&gt;&gt; DataSerializableFactories { get; }

#pragma warning disable IDE0052 // Remove unread private members - used by binding
        [BinderIgnore(false)]
        [BinderName(&quot;dataSerializableFactories&quot;)]
        private CollectionBinder&lt;IdentifiedInjectionOptions&gt; DataSerializableFactoriesBinder { get; }
#pragma warning restore IDE0052 // Remove unread private members

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IDataSerializableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factory&quot;&gt;The factory.&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddDataSerializableFactory(int factoryId, IDataSerializableFactory factory)
        {
            DataSerializableFactories.Add(new FactoryOptions&lt;IDataSerializableFactory&gt; { Id = factoryId, Creator = () =&gt; factory });
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IDataSerializableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factoryTypeName&quot;&gt;The type name of the factory&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddDataSerializableFactoryClass(int factoryId, string factoryTypeName)
        {
            DataSerializableFactories.Add(new FactoryOptions&lt;IDataSerializableFactory&gt; { Id = factoryId, Creator = () =&gt; ServiceFactory.CreateInstance&lt;IDataSerializableFactory&gt;(factoryTypeName, null) });
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IDataSerializableFactory&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;factoryId&quot;&gt;The identifier of the factory.&lt;/param&gt;
        /// &lt;param name=&quot;factoryType&quot;&gt;The type of the factory&lt;/param&gt;
        /// &lt;returns&gt;The &lt;see cref=&quot;SerializationOptions&quot;/&gt;.&lt;/returns&gt;
        public SerializationOptions AddDataSerializableFactoryClass(int factoryId, Type factoryType)
        {
            DataSerializableFactories.Add(new FactoryOptions&lt;IDataSerializableFactory&gt; { Id = factoryId, Creator = () =&gt; ServiceFactory.CreateInstance&lt;IDataSerializableFactory&gt;(factoryType, null) });
            return this;
        }

        #endregion

        #region Serializers

        /// &lt;summary&gt;
        /// Gets the &lt;see cref=&quot;GlobalSerializerOptions&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;When defined in a configuration file, it is defined as an injected type, for instance:
        /// &lt;code&gt;
        /// &quot;globalSerializer&quot;:
        /// {
        ///   &quot;typeName&quot;: &quot;My.Serializer&quot;,
        ///   &quot;args&quot;:
        ///   {
        ///     &quot;foo&quot;: 42
        ///   },
        ///   &quot;overrideClrSerialization&quot;: true
        /// }
        /// &lt;/code&gt;
        /// with the additional &lt;c&gt;overrideClrSerialization&lt;/c&gt; property.&lt;/para&gt;
        /// &lt;/remarks&gt;
        [BinderIgnore]
        public GlobalSerializerOptions GlobalSerializer { get; set; } = new GlobalSerializerOptions();

#pragma warning disable IDE0051 // Remove unused private members - used by binding
        [BinderIgnore(false)]
        [BinderName(&quot;globalSerializer&quot;)]
        private GlobalSerializerInjectionOptions GlobalSerializerBinder
        {
            get =&gt; default;
            set
            {
                GlobalSerializer = new GlobalSerializerOptions
                {
                    OverrideClrSerialization = value.OverrideClrSerialization,
                    Creator = () =&gt; ServiceFactory.CreateInstance&lt;ISerializer&gt;(value.TypeName, value.Args)
                };
            }
        }
#pragma warning restore IDE0051 // Remove unused private members

        /// &lt;summary&gt;
        /// Gets the collection of &lt;see cref=&quot;SerializerOptions&quot;/&gt;.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;&lt;/para&gt;
        /// &lt;/remarks&gt;
        [BinderIgnore]
        public ICollection&lt;SerializerOptions&gt; Serializers { get; }

#pragma warning disable IDE0052 // Remove unread private members - used by binding
        [BinderIgnore(false)]
        [BinderName(&quot;serializers&quot;)]
        private CollectionBinder&lt;SerializerInjectionOptions&gt; SerializersBinder { get; }
#pragma warning restore IDE0052 // Remove unread private members

        #endregion

        internal class IdentifiedInjectionOptions : InjectionOptions
        {
            public int Id { get; set; }

            protected override void ToString(StringBuilder text)
            {
                base.ToString(text);
                text.Append(&quot;, id: &quot;);
                text.Append(Id);
            }
        }

        internal class SerializerInjectionOptions : InjectionOptions
        {
            public string SerializedTypeName { get; set; }

            protected override void ToString(StringBuilder text)
            {
                base.ToString(text);
                text.Append(&quot;, serializedTypeName: &#39;&quot;);
                text.Append(SerializedTypeName ?? &quot;&lt;null&gt;&quot;);
                text.Append(&#39;\&#39;&#39;);
            }
        }

        internal class GlobalSerializerInjectionOptions : InjectionOptions
        {
            public bool OverrideClrSerialization { get; set; }

            protected override void ToString(StringBuilder text)
            {
                base.ToString(text);
                text.Append(&quot;, overrideClr: &quot;);
                text.Append(OverrideClrSerialization);
            }
        }

        /// &lt;summary&gt;
        /// Clones the options.
        /// &lt;/summary&gt;
        internal SerializationOptions Clone() =&gt; new SerializationOptions(this);
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[39,9,39,38,1],[41,13,41,78,1],[42,13,44,17,1],[44,17,47,37,1],[47,37,47,110,1],[47,110,48,20,1],[48,20,49,13,1],[49,13,49,14,1],[49,14,49,16,1],[51,13,51,94,1],[52,13,54,17,1],[54,17,57,37,1],[57,37,57,118,1],[57,118,58,20,1],[58,20,59,13,1],[59,13,59,14,1],[59,14,59,16,1],[61,13,61,57,1],[62,13,64,17,1],[64,17,67,37,1],[67,37,67,105,1],[67,105,68,20,1],[68,20,69,13,1],[69,13,69,14,1],[69,14,69,16,1],[70,9,70,10,1],[75,9,75,65,1],[77,13,77,43,1],[78,13,78,71,1],[79,13,79,53,1],[81,13,81,86,1],[82,13,82,101,1],[83,13,83,125,1],[85,13,85,64,1],[86,13,86,74,1],[87,9,87,10,1],[93,40,93,44,1],[93,45,93,49,1],[99,48,99,52,1],[99,53,99,57,1],[99,62,99,66,1],[99,62,99,66,1],[104,38,104,42,1],[104,43,104,47,1],[114,65,114,69,1],[114,74,114,105,1],[114,74,114,105,1],[124,82,124,86,1],[129,88,129,92,1],[140,13,140,106,1],[140,106,140,113,1],[140,113,140,117,1],[141,13,141,25,1],[152,13,152,106,1],[152,106,152,172,1],[152,172,152,176,1],[153,13,153,25,1],[164,13,164,106,0],[164,106,164,176,0],[164,176,164,180,0],[165,13,165,25,0],[176,98,176,102,1],[181,96,181,100,1],[192,13,192,122,1],[192,122,192,129,1],[192,129,192,133,1],[193,13,193,25,1],[204,13,204,122,0],[204,122,204,200,0],[204,200,204,204,0],[205,13,205,25,0],[216,13,216,122,1],[216,122,216,196,1],[216,196,216,200,1],[217,13,217,25,1],[243,59,243,63,1],[243,64,243,68,1],[243,73,243,102,1],[243,73,243,102,1],[250,20,250,27,1],[253,17,256,37,1],[256,37,256,107,1],[256,107,257,19,1],[258,13,258,14,1],[269,61,269,65,1],[274,82,274,86,1],[281,29,281,33,1],[281,34,281,38,1],[285,17,285,37,0],[286,17,286,39,0],[287,17,287,33,0],[288,13,288,14,0],[293,48,293,52,1],[293,53,293,57,1],[297,17,297,37,0],[298,17,298,56,0],[299,17,299,61,0],[300,17,300,35,0],[301,13,301,14,0],[306,52,306,56,1],[306,57,306,61,1],[310,17,310,37,0],[311,17,311,48,0],[312,17,312,55,0],[313,13,313,14,0],[319,50,319,80,1]]);
    </script>
  </body>
</html>