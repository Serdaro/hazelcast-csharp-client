<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\HazelcastOptionsBuilder.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using Hazelcast.Configuration;
using Hazelcast.Configuration.Binding;
using Hazelcast.Exceptions;
using Microsoft.Extensions.Configuration;

namespace Hazelcast
{
    /// &lt;summary&gt;
    /// Provides a way to build &lt;see cref=&quot;HazelcastOptions&quot;/&gt; instances in a fluent way.
    /// &lt;/summary&gt;
    public class HazelcastOptionsBuilder
    {
        private string[] _args;
        private IDictionary&lt;string, string&gt; _switchMappings;
        private Dictionary&lt;string, string&gt; _defaults;
        private Dictionary&lt;string, string&gt; _keyValues;
        private string _optionsFilePath;
        private string _optionsFileName;
        private string _environmentName;
        private string _altKey;
        private List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt; _configureActions;
        private List&lt;Action&lt;IConfigurationBuilder&gt;&gt; _setups;

        /// &lt;summary&gt;
        /// Sets the command-line arguments to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;args&quot;&gt;The command-line arguments.&lt;/param&gt;
        /// &lt;param name=&quot;switchMappings&quot;&gt;Optional command-line switch mappings.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string[] args, IDictionary&lt;string, string&gt; switchMappings = null)
        {
            _args = args ?? throw new ArgumentNullException(nameof(args));
            _switchMappings = switchMappings;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds a default key/value pair to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithDefault(string key, string value)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));
            // assuming value can be null or empty

            _defaults ??= new Dictionary&lt;string, string&gt;();
            _defaults[key] = value;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds a key/value pair to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(string key, string value)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));
            // assuming value can be null or empty

            _keyValues ??= new Dictionary&lt;string, string&gt;();
            _keyValues[key] = value;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the path (without filename) to the options files to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;filePath&quot;&gt;The file path.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the options file is searched in the
        /// default .NET configuration location, which usually is where the application resides.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFilePath(string filePath)
        {
            if (string.IsNullOrWhiteSpace(filePath)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(filePath));

            _optionsFilePath = filePath;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the name (without path, with extension) of the options file to read when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;fileName&quot;&gt;The name of the file.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is &quot;hazelcast&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithFileName(string fileName)
        {
            if (string.IsNullOrWhiteSpace(fileName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(fileName));

            _optionsFileName = fileName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the environment name to use when building the options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;environmentName&quot;&gt;The environment name.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        /// &lt;remarks&gt;
        /// &lt;para&gt;By default, when not provided, the name is determined the standard .NET way,
        /// i.e. from the &lt;c&gt;DOTNET_ENVIRONMENT&lt;/c&gt; and &lt;c&gt;ASPNETCORE_ENVIRONMENT&lt;/c&gt; variables and,
        /// if not specified, defaults to &quot;Production&quot;.&lt;/para&gt;
        /// &lt;/remarks&gt;
        public HazelcastOptionsBuilder WithEnvironment(string environmentName)
        {
            if (string.IsNullOrWhiteSpace(environmentName)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(environmentName));

            _environmentName = environmentName;
            return this;
        }

        /// &lt;summary&gt;
        /// Sets the alternate key for options.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The alternate key.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder WithAltKey(string key)
        {
            if (string.IsNullOrWhiteSpace(key)) throw new ArgumentException(ExceptionMessages.NullOrEmpty, nameof(key));

            _altKey = key;
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;IConfiguration, HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));

            _configureActions ??= new List&lt;Action&lt;IConfiguration, HazelcastOptions&gt;&gt;();
            _configureActions.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;HazelcastOptions&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder With(Action&lt;HazelcastOptions&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));
            return With((_, o) =&gt; configure(o));
        }

        /// &lt;summary&gt;
        /// Adds an &lt;see cref=&quot;IConfigurationBuilder&quot;/&gt; configuration delegate.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;configure&quot;&gt;The delegate.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder ConfigureBuilder(Action&lt;IConfigurationBuilder&gt; configure)
        {
            if (configure == null) throw new ArgumentNullException(nameof(configure));

            _setups ??= new List&lt;Action&lt;IConfigurationBuilder&gt;&gt;();
            _setups.Add(configure);
            return this;
        }

        /// &lt;summary&gt;
        /// Binds an additional options instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;key&quot;&gt;The key for the instance.&lt;/param&gt;
        /// &lt;param name=&quot;instance&quot;&gt;The instance.&lt;/param&gt;
        /// &lt;returns&gt;This options builder.&lt;/returns&gt;
        public HazelcastOptionsBuilder Bind(string key, object instance)
            =&gt; With((configuration, _) =&gt; configuration.HzBind(key, instance));

        private void Configure(IConfiguration configuration, HazelcastOptions options)
        {
            if (_configureActions == null) return;

            foreach (var configure in _configureActions)
                configure(configuration, options);
        }

        private void Setup(IConfigurationBuilder builder)
        {
            builder.AddHazelcastAndDefaults(_args, _switchMappings, _defaults, _keyValues, _optionsFilePath, _optionsFileName, _environmentName);

            if (_setups == null) return;

            foreach (var setup in _setups)
                setup(builder);
        }

        /// &lt;summary&gt;
        /// Builds the options.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The options.&lt;/returns&gt;
        public HazelcastOptions Build()
        {
            return HazelcastOptions.Build(Setup, Configure, _altKey);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[48,13,48,75,0],[49,13,49,46,0],[50,13,50,25,0],[61,13,61,48,0],[61,49,61,121,0],[64,13,64,60,0],[65,13,65,36,0],[66,13,66,25,0],[77,13,77,48,1],[77,49,77,121,0],[80,13,80,61,1],[81,13,81,37,1],[82,13,82,25,1],[96,13,96,53,0],[96,54,96,131,0],[98,13,98,41,0],[99,13,99,25,0],[112,13,112,53,0],[112,54,112,131,0],[114,13,114,41,0],[115,13,115,25,0],[130,13,130,60,0],[130,61,130,145,0],[132,13,132,48,0],[133,13,133,25,0],[143,13,143,48,1],[143,49,143,121,0],[145,13,145,27,1],[146,13,146,25,1],[156,13,156,35,1],[156,36,156,87,0],[158,13,158,88,1],[159,13,159,46,1],[160,13,160,25,1],[170,13,170,35,1],[170,36,170,87,0],[171,13,171,35,1],[171,35,171,47,1],[171,47,171,49,1],[181,13,181,35,1],[181,36,181,87,0],[183,13,183,67,1],[184,13,184,36,1],[185,13,185,25,1],[195,16,195,43,0],[195,43,195,78,0],[195,78,195,79,0],[199,13,199,43,1],[199,44,199,51,1],[201,22,201,35,1],[201,36,201,38,1],[201,39,201,56,1],[202,17,202,51,1],[203,9,203,10,1],[207,13,207,146,1],[209,13,209,33,1],[209,34,209,41,1],[211,22,211,31,1],[211,32,211,34,1],[211,35,211,42,1],[212,17,212,32,1],[213,9,213,10,1],[221,13,221,70,1]]);
    </script>
  </body>
</html>