<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\Serialization\ClassDefinition.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// Copyright (c) 2008-2021, Hazelcast, Inc. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Hazelcast.Serialization
{
    internal class ClassDefinition : IClassDefinition
    {
        private readonly int _classId;
        private readonly int _factoryId;

        private readonly IDictionary&lt;string, IFieldDefinition&gt; _fieldDefinitionsMap =
            new Dictionary&lt;string, IFieldDefinition&gt;();

        private int _version = -1;

        public ClassDefinition()
        { }

        public ClassDefinition(int factoryId, int classId, int version)
        {
            _factoryId = factoryId;
            _classId = classId;
            _version = version;
        }

        public virtual IFieldDefinition GetField(string name)
        {
            return _fieldDefinitionsMap.TryGetValue(name, out var val) ? val : null;
        }

        public virtual IFieldDefinition GetField(int fieldIndex)
        {
            if (fieldIndex &lt; 0 || fieldIndex &gt;= _fieldDefinitionsMap.Count)
                throw new ArgumentOutOfRangeException(nameof(fieldIndex), $&quot;Cannot get field with index {fieldIndex}, map contains {_fieldDefinitionsMap.Count} fields.&quot;);

            var fieldDefinition = _fieldDefinitionsMap.Values.FirstOrDefault(x =&gt; x.Index == fieldIndex);
            if (fieldDefinition != null) return fieldDefinition;

            throw new InvalidOperationException($&quot;Failed to find field with index {fieldIndex} in map containing {_fieldDefinitionsMap.Count} fields.&quot;);
        }

        public virtual bool HasField(string fieldName)
        {
            return _fieldDefinitionsMap.ContainsKey(fieldName);
        }

        public virtual ICollection&lt;string&gt; GetFieldNames()
        {
            return new HashSet&lt;string&gt;(_fieldDefinitionsMap.Keys);
        }

        public virtual FieldType GetFieldType(string fieldName)
        {
            var fd = GetField(fieldName);
            if (fd != null)
            {
                return fd.FieldType;
            }
            throw new ArgumentException(&quot;Unknown field: &quot; + fieldName);
        }

        public virtual int GetFieldClassId(string fieldName)
        {
            var fd = GetField(fieldName);
            if (fd != null)
            {
                return fd.ClassId;
            }
            throw new ArgumentException(&quot;Unknown field: &quot; + fieldName);
        }

        public virtual int GetFieldCount()
        {
            return _fieldDefinitionsMap.Count;
        }

        public int FactoryId =&gt; _factoryId;

        public int ClassId =&gt; _classId;

        public int Version =&gt; _version;

        public override bool Equals(object obj)
        {
            if (obj is null) return false;
            if (ReferenceEquals(this, obj)) return true;
            if (obj.GetType() != GetType()) return false;
            return Equals((ClassDefinition) obj);
        }

        public override int GetHashCode()
        {
            var result = _classId;
            result = 31*result + _version;
            return result;
        }

        public override string ToString()
        {
            var sb = new StringBuilder();
            sb.Append(&quot;ClassDefinition&quot;);
            sb.Append(&quot;{factoryId=&quot;).Append(_factoryId);
            sb.Append(&quot;, classId=&quot;).Append(_classId);
            sb.Append(&quot;, version=&quot;).Append(_version);
            sb.Append(&quot;, fieldDefinitions=&quot;).Append(_fieldDefinitionsMap.Values);
            sb.Append(&#39;}&#39;);
            return sb.ToString();
        }

        protected bool Equals(ClassDefinition other)
        {
            return _factoryId == other._factoryId &amp;&amp; _classId == other._classId &amp;&amp; _version == other._version &amp;&amp;
                   _fieldDefinitionsMap.Count == other._fieldDefinitionsMap.Count &amp;&amp;
                   !_fieldDefinitionsMap.Except(other._fieldDefinitionsMap).Any();
        }

        internal virtual void AddFieldDef(FieldDefinition fd)
        {
            _fieldDefinitionsMap[fd.Name] = fd;
        }

        internal virtual ICollection&lt;IFieldDefinition&gt; GetFieldDefinitions()
        {
            return _fieldDefinitionsMap.Values;
        }

        internal virtual void SetVersionIfNotSet(int version)
        {
            if (Version &lt; 0)
            {
                _version = version;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[27,9,28,56,0],[27,9,28,56,0],[30,9,30,35,0],[30,9,30,35,0],[32,9,32,33,0],[33,11,33,12,0],[35,9,35,72,0],[37,13,37,36,0],[38,13,38,32,0],[39,13,39,32,0],[40,9,40,10,0],[44,13,44,85,0],[49,13,49,76,0],[50,17,50,171,0],[52,13,52,83,0],[52,83,52,104,0],[52,104,52,106,0],[53,13,53,41,0],[53,42,53,65,0],[55,13,55,153,0],[60,13,60,64,0],[65,13,65,67,0],[70,13,70,42,0],[71,13,71,28,0],[73,17,73,37,0],[75,13,75,72,0],[80,13,80,42,0],[81,13,81,28,0],[83,17,83,35,0],[85,13,85,72,0],[90,13,90,47,0],[93,33,93,43,0],[95,31,95,39,0],[97,31,97,39,0],[101,13,101,29,0],[101,30,101,43,0],[102,13,102,44,0],[102,45,102,57,0],[103,13,103,44,0],[103,45,103,58,0],[104,13,104,50,0],[109,13,109,35,0],[110,13,110,43,0],[111,13,111,27,0],[116,13,116,42,0],[117,13,117,42,0],[118,13,118,57,0],[119,13,119,54,0],[120,13,120,54,0],[121,13,121,82,0],[122,13,122,28,0],[123,13,123,34,0],[128,13,130,83,0],[135,13,135,48,0],[136,9,136,10,0],[140,13,140,48,0],[145,13,145,29,0],[147,17,147,36,0],[149,9,149,10,0]]);
    </script>
  </body>
</html>