<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\a\hazelcast-csharp-client\hazelcast-csharp-client\src\Hazelcast.Net\CP\AtomicReference.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Threading.Tasks;
using Hazelcast.Clustering;
using Hazelcast.Core;
using Hazelcast.DistributedObjects;
using Hazelcast.Protocol.Codecs;
using Hazelcast.Serialization;

namespace Hazelcast.CP
{
    /// &lt;summary&gt;
    /// Provides the &lt;see cref=&quot;IAtomicReference{T}&quot;/&gt; implementation.
    /// &lt;/summary&gt;
    internal class AtomicReference&lt;T&gt;: CPDistributedObjectBase, IAtomicReference&lt;T&gt;
    {
        /// &lt;summary&gt;
        /// Initializes a new instance of the &lt;see cref=&quot;AtomicReference{T}&quot;/&gt; class.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The unique name.&lt;/param&gt;
        /// &lt;param name=&quot;groupId&quot;&gt;The CP group identifier.&lt;/param&gt;
        /// &lt;param name=&quot;cluster&quot;&gt;The cluster.&lt;/param&gt;
        /// &lt;param name=&quot;serializationService&quot;&gt;The serialization service.&lt;/param&gt;
        public AtomicReference(string name, CPGroupId groupId, Cluster cluster, SerializationService serializationService)
            : base(ServiceNames.AtomicRef, name, groupId, cluster)
        {
            SerializationService = serializationService ?? throw new ArgumentNullException(nameof(serializationService));
        }

        protected SerializationService SerializationService { get; }

        /// &lt;inheritdoc /&gt;
        public async Task&lt;bool&gt; CompareAndSetAsync(T comparand, T value)
        {
            var requestMessage = AtomicRefCompareAndSetCodec.EncodeRequest(CPGroupId, Name, ToData(comparand), ToData(value));
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefCompareAndSetCodec.DecodeResponse(responseMessage).Response;
            return response;
        }

        /// &lt;inheritdoc /&gt;
        public async Task&lt;T&gt; GetAsync()
        {
            var requestMessage = AtomicRefGetCodec.EncodeRequest(CPGroupId, Name);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefGetCodec.DecodeResponse(responseMessage).Response;
            return ToObject(response);
        }

        /// &lt;inheritdoc /&gt;
        public async Task SetAsync(T value)
        {
            var requestMessage = AtomicRefSetCodec.EncodeRequest(CPGroupId, Name, ToData(value), returnOldValue: false);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefSetCodec.DecodeResponse(responseMessage).Response;
        }

        /// &lt;inheritdoc /&gt;
        public async Task&lt;T&gt; GetAndSetAsync(T value)
        {
            var requestMessage = AtomicRefSetCodec.EncodeRequest(CPGroupId, Name, ToData(value), returnOldValue: true);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefSetCodec.DecodeResponse(responseMessage).Response;
            return ToObject(response);
        }

        /// &lt;inheritdoc /&gt;
        public async Task&lt;bool&gt; IsNullAsync()
        {
            var requestMessage = AtomicRefContainsCodec.EncodeRequest(CPGroupId, Name, null);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefContainsCodec.DecodeResponse(responseMessage).Response;
            return response;
        }

        /// &lt;inheritdoc /&gt;
        public async Task ClearAsync()
        {
            var requestMessage = AtomicRefSetCodec.EncodeRequest(CPGroupId, Name, null, returnOldValue: false);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefSetCodec.DecodeResponse(responseMessage).Response;
        }

        /// &lt;inheritdoc /&gt;
        public async Task&lt;bool&gt; ContainsAsync(T value)
        {
            var requestMessage = AtomicRefContainsCodec.EncodeRequest(CPGroupId, Name, ToData(value));
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = AtomicRefContainsCodec.DecodeResponse(responseMessage).Response;
            return response;
        }

        /// &lt;inheritdoc /&gt;
        public override async ValueTask DestroyAsync()
        {
            var requestMessage = CPGroupDestroyCPObjectCodec.EncodeRequest(CPGroupId, ServiceName, Name);
            var responseMessage = await Cluster.Messaging.SendAsync(requestMessage).CfAwait();
            var response = CPGroupDestroyCPObjectCodec.DecodeResponse(responseMessage);
        }

        protected IData ToData(T value) =&gt; SerializationService.ToData(value);
        protected T ToObject(IData data) =&gt; SerializationService.ToObject&lt;T&gt;(data);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[24,15,24,67,0],[26,13,26,122,0],[27,9,27,10,0],[29,63,29,67,0],[34,13,34,127,0],[35,13,35,95,0],[36,13,36,97,0],[37,13,37,29,0],[38,9,38,10,0],[43,13,43,83,0],[44,13,44,95,0],[45,13,45,87,0],[46,13,46,39,0],[47,9,47,10,0],[52,13,52,121,0],[53,13,53,95,0],[54,13,54,87,0],[55,9,55,10,0],[60,13,60,120,0],[61,13,61,95,0],[62,13,62,87,0],[63,13,63,39,0],[64,9,64,10,0],[69,13,69,94,0],[70,13,70,95,0],[71,13,71,92,0],[72,13,72,29,0],[73,9,73,10,0],[78,13,78,112,0],[79,13,79,95,0],[80,13,80,87,0],[81,9,81,10,0],[86,13,86,103,0],[87,13,87,95,0],[88,13,88,92,0],[89,13,89,29,0],[90,9,90,10,0],[95,13,95,106,0],[96,13,96,95,0],[97,13,97,88,0],[98,9,98,10,0],[100,44,100,78,0],[101,45,101,83,0]]);
    </script>
  </body>
</html>